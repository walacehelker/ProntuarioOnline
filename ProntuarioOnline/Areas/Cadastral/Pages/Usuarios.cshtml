@page
@model UsuariosModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
  Layout = "_Layout";
}

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Usuários Cadastrados</h4>
    <a asp-page="UsuariosCad" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> Novo Usuário
    </a>
  </div>

  @if (Model.Usuarios != null && Model.Usuarios.Any())
  {
    <table id="dadosTable" class="table table-striped table-hover">
      <thead class="table-light">
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Tipo do Usuário</th>
          <th style="width: 180px;">Ações</th>
        </tr>
      </thead>
      <tbody>
        @foreach (var usuario in Model.Usuarios)
        {
          <tr>
            <td>@usuario.NomeCompleto</td>
            <td>@usuario.Email</td>
            <td>@Html.DisplayFor(modelItem => usuario.TipoUsuario)</td>
            <td>
              <a asp-page="UsuariosCad" asp-route-id="@usuario.Id"
                 class="btn btn-sm btn-outline-warning me-1">
                <i class="bi bi-pencil"></i> Editar
              </a>
              <a asp-page="UsuariosAssinaturas" asp-route-id="@usuario.Id"
                 class="btn btn-sm btn-outline-info me-1">
                <i class="bi bi-card-checklist"></i> Assinaturas
              </a>
              <form method="post" asp-page-handler="Delete" asp-route-id="@usuario.Id"
                    class="d-inline"
                    onsubmit="return confirm('Tem certeza que deseja excluir este usuário?');">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="bi bi-trash"></i> Excluir
                </button>
              </form>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
  else
  {
    <div class="alert alert-info">Nenhum usuário cadastrado.</div>
  }
</div>

@section Scripts {
  <script>
    $(document).ready(function () {
        $('#dadosTable').DataTable({
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
            },
            pageLength: 10,
            lengthMenu: [5, 10, 25, 50, 100],
            ordering: true,
            searching: true,
            responsive: true,

            // Layout customizado
            dom:
              // 'f' = filtro (search box)
              // 't' = tabela
              // 'i' = info (Mostrando X de Y)
              // 'p' = paginação
              // 'l' = lengthMenu (quantidade de linhas)
              // '<"row"...>' = grid bootstrap
              '<"row mb-2"<"col-sm-12 text-start"f>>' +   // search em cima à esquerda
              '<"row"<"col-sm-12"tr>>' +                  // tabela no meio
              '<"row mt-2"<"col-sm-4"i><"col-sm-4"p><"col-sm-4"l>>', // info + paginação + lengthMenu embaixo

            initComplete: function () {
                // deixa o campo de pesquisa maior e com placeholder
                $('.dataTables_filter input')
                    .addClass('form-control form-control-lg')
                    .css('width', '300px')
                    .attr('placeholder', 'Pesquisar...');
            }
        });
    });
  </script>
}